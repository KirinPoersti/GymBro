{% extends "base.html" %}
{% block wrap_class %}wrap--wide{% endblock %}
{% block header %}{% endblock %}

{% block content %}
<!-- Top bar -->
<div class="topbar">
  <div class="brand-block">
    <div class="brand">GymBro</div>
    <div class="welcome">Hi, {{ session['username'] }} üëã</div>
  </div>
  <div class="actions">
    <a class="icon-btn" title="Profile" href="{{ url_for('profile') }}">üë§</a>
    <a class="icon-btn" title="Settings" href="{{ url_for('settings') }}">‚öôÔ∏è</a>
    <a class="logout" href="{{ url_for('logout') }}">Logout</a>
  </div>
</div>

<!-- Month header controls -->
<div class="monthbar">
  <a href="{{ url_for('dashboard', y=prev_y, m=prev_m) }}">‚Üê Previous</a>
  <div class="monthtitle">{{ year }} ‚Äì {{ "%02d"|format(month) }}</div>
  <a href="{{ url_for('dashboard', y=next_y, m=next_m) }}">Next ‚Üí</a>
</div>

<!-- Weekday headers -->
<div class="wkhdr">
  {% for n in ["MON","TUE","WED","THU","FRI","SAT","SUN"] %}
    <div class="cell head">{{ n }}</div>
  {% endfor %}
</div>

<!-- 6x7 calendar grid -->
<div class="grid">
  {% for d in grid %}
    {% set dim = (d.month != month) %}
    {% set is_today = (d == today) %}
    {% set has_workout = d.isoformat() in workout_dates %}
    {% set is_low = d.isoformat() in lowcarb_dates %}
    {% set is_high = d.isoformat() in highcarb_dates %}
    <a class="cell day
              {% if dim %} dim{% endif %}
              {% if is_today %} today{% endif %}
              {% if is_low %} lowcarb{% endif %}
              {% if is_high %} highcarb{% endif %}"
       href="{{ url_for('day_view', d=d.isoformat()) }}">
      <div class="num">{{ d.day }}</div>
      {% if has_workout %}
        <div class="tick" title="Workout logged">‚úì</div>
      {% endif %}
    </a>
  {% endfor %}
</div>

<style>
  .cell.head{
    align-items:center; justify-content:center; font-weight:700; height:44px;
    background:#A91B0D;   
    color:#fff;           
    border-color:#222;
  }

  .cell.day.lowcarb { background: #D2DDE9; }  
  .cell.day.highcarb { background: #A8E4A0; }

  .cell.day .num { font-weight:700; font-size:14px; color:#111; }

  .cell.day .tick{
    position:absolute; right:8px; bottom:6px;
    font-weight:800; font-size:50px; line-height:1;
    color:#16a34a;
  }

  .cell.day.today{ outline:3px solid #7aa7ff; outline-offset:-3px; }

  .topbar {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  margin-bottom: 14px;
}
  .brand-block {
    display: flex;
    flex-direction: column;
}
  .brand{ 
    font-weight:400; 
    font-size:34px; 
    text-decoration:none; 
    color:#111;
}
  .welcome {
  font-size: 16px;
  margin-top: 4px;
  color: #333;
}
  .actions {
  display: flex;
  align-items: center;
  gap: 10px;
}
  .icon-btn {
  display: inline-flex; align-items: center; justify-content: center;
  width: 40px; height: 40px;
  border: 1.5px solid #222; border-radius: 10px;
  text-decoration: none; font-size: 20px;
  background: #fff; color: #111;
}
  .logout {
    font-size: 15px;
    text-decoration: none;
    padding: 8px 14px;
    border: 1.5px solid #222;
    border-radius: 8px;
    background: #fff;
    color: #111;
}
  .logout:hover {
    background: #f5f5f5;
}
  .monthbar{ display:flex; align-items:center; justify-content:space-between; margin:6px 0 10px; }
  .monthtitle{ font-weight:700; }

  .wkhdr{ display:grid; grid-template-columns:repeat(7,1fr); gap:10px; margin-bottom:8px; }

  .grid{ display:grid; grid-template-columns:repeat(7,1fr); grid-auto-rows:94px; gap:10px; }

  .cell{
    border:1.5px solid #222; border-radius:14px; background:#fff;
    display:flex; align-items:flex-start; justify-content:flex-start;
    padding:8px; text-decoration:none; color:#111; position:relative;
  }
  .cell.day .num{ font-weight:700; font-size:14px; }
  .cell.day.dim{ opacity:.45; }
  .cell.day.today{ outline:3px solid #7aa7ff; outline-offset:-3px; }

  @media (max-width:860px){
    .wrap--wide{ max-width:100%; }
    .grid{ grid-auto-rows:80px; }
  }
</style>
{% endblock %}
